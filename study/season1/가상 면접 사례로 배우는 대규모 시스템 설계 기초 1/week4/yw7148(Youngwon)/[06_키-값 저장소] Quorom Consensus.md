---
marp: true
theme: default
paginate: true
_paginate: false
---

# 분산 데이터 시스템에서의 정족수 합의

---

## 정족수 합의란 무엇인가?

- 정족수 합의는 분산 시스템에서 노드 간의 일관성과 조정을 달성하기 위해 사용되는 방법입니다.
- 다수의 노드가 결정에 동의해야만 그 결정이 받아들여집니다.

---

## 정족수 합의의 장점

- **일관성**: 노드 간의 데이터 일관성을 보장합니다.
- **내결함성**: 정족수이 달성되는 한 노드 장애를 견딜 수 있습니다.
- **확장성**: 대규모 분산 시스템에 적합합니다.

---

## 정족수 합의의 단점

- **지연**: 여러 노드의 응답이 필요하기 때문에 지연이 발생할 수 있습니다.
- **복잡성**: 더 간단한 합의 방법에 비해 구현 및 관리가 복잡합니다.

---

## 정족수 합의의 작동 방식

1. **정족수 읽기**: 읽기 작업은 다수의 노드가 동일한 데이터를 응답해야 합니다.
2. **정족수 쓰기**: 쓰기 작업은 다수의 노드가 쓰기를 승인해야 합니다.

---

## 정족수 공식
- 정족수 공식은 일반적으로 다음과 같이 표현됩니다:
    - `R + W > N`
    - 여기서 `R`은 읽기에 필요한 노드 수, `W`는 쓰기에 필요한 노드 수, `N`은 전체 노드 수입니다.
    - 일관성이 보장되는 이유: 읽기와 쓰기 작업에서 하나 이상의 서버가 중복되게 되어, 항상 최신 데이터를 읽을 수 있습니다.

---

## 엄격한 정족수

- **엄격한 정족수 (strict)**: 엄격한 정족수는 다수의 노드 응답이 필요한 방법입니다. 이는 일관성을 높이는 데 유리하지만, 지연이 증가하고 가용성이 낮아질 수 있습니다.

- **느슨한 정족수 (sloppy)**: 느슨한 정족수는 일부 노드의 응답만으로도 합의가 이루어질 수 있는 방법입니다. 이는 지연을 줄이고 가용성을 높이는 데 유리하지만, 일관성이 약해질 수 있습니다.

---

## Hinted-Handoff는 Sloppy Quorum인가?

- **예**
- Sloppy Quorum의 대표적인 예입니다.
- 원래의 책임 노드(Owner 노드)가 장애가 발생했을 경우, 다른 **임시 노드가 Quorum Consensus에 참여**하여 복제본을 저장합니다. 이후, 해당 노드를 포함하여 W/R (정족수)를 만족할 경우 정상으로 인식됩니다.

---

## 엥 그렇다면 Strict Quorom과 Sloppy Quorom을 모두 만족할 수 있는가?
- **예**
- 이 둘은 서로 배타적인 관계가 아니라, 각각 다른 레이어의 설계 기법입니다. 따라서,
    1. W와 R이 높아서 Strict Quorum을 보장하고,
    2. 장애 시에도 임시 노드를 사용하여 Hinted Handoff를 한다면 Sloppy Quorum을 적용할 수 있습니다.

→ 이는 "Strict Quorum + Sloppy Quorum"이 동시에 적용되는 형태이며, 전혀 모순되지 않습니다.

---

## 잠재적으로 느슨해진 일관성

- 일시적으로 ‘원래 Replica Set이 아닌 다른 노드’가 데이터를 가지고 있을 수 있으므로, 일관성이 낮아질 수 있습니다.
- 장애에서 복구된 후, 리페어(Repair) 프로세스를 통해 원래 노드와 최종적으로 동기화(Replication)해야 합니다. 그 전까지는 데이터가 최신 버전과 달라질 수 있습니다(이벤트추얼 일관성).

---

## 가십 프로토콜과 느슨한 일관성 정족수 모델

- **가십 프로토콜**: 분산 시스템에서 노드 간의 정보를 전파하기 위해 사용되는 프로토콜입니다. 각 노드는 주기적으로 임의의 다른 노드와 정보를 교환하여 시스템 전체에 정보를 전파합니다.
- **느슨한 일관성 정족수 모델**: 가십 프로토콜은 느슨한 일관성 모델을 따릅니다. 이는 모든 노드가 항상 최신 상태를 가지지 않을 수 있음을 의미합니다. 대신, 시간이 지남에 따라 일관성이 수렴됩니다.

---

### 가십 프로토콜 작동 방식 (SWIM 프로토콜 예시)

1. **Ping 단계**: 주기적으로 랜덤하게 선택된 타겟 노드에게 Ping을 보내 장애 여부를 탐지합니다. 응답이 없으면 다른 노드에게 간접 Ping을 요청해 상태를 재검증합니다.
2. **Suspicion 단계**: 타겟 노드의 응답이 계속 없으면 "Suspicious(의심)" 상태로 전환하고, 이를 다른 노드들에게 가십으로 알립니다.
3. **확정(Faulty) 단계**: 의심 상태인 노드가 일정 시간 내에 살아있음을 입증하지 못하면 "Faulty(장애)" 상태로 간주하고, 멤버십 리스트에서 제외합니다.
4. **멤버십 전파**: 장애 상태나 갱신된 정보를 주기적으로 다른 노드에게 전파합니다.

---

### 가십 프로토콜 장점

- **확장성**: 대규모 시스템에서도 효율적으로 동작합니다.
- **내결함성**: 일부 노드의 장애에 강합니다.
- **간단한 구현**: 비교적 간단하게 구현할 수 있습니다.

### 가십 프로토콜 단점

- **일관성 지연**: 모든 노드가 최신 정보를 가지기까지 시간이 걸릴 수 있습니다.
- **추가 오버헤드**: 주기적인 정보 교환으로 인해 네트워크 오버헤드가 발생할 수 있습니다.

---

# 감사합니다!